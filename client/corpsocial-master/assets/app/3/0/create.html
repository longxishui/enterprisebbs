<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>新建外出申请</title>

    <link rel="stylesheet" href="../../commons/jquery.mobile/jquery.mobile-1.3.2.min.css">
    <link href="../../lib/mobiscroll-2.6.2/css/mobiscroll.custom-2.6.2.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="../../lib/mobiscroll-2.6.2/css/mobiscroll.android-ics-2.6.2.css" rel="stylesheet"
          type="text/css"/>
    <script src="../../commons/jquery.mobile/jquery.js"></script>

    <!--
    <link rel="stylesheet" href="../../lib/jquery1.4.4/defaulttheme/jquery.mobile-1.4.4.min.css">
    <script src="../../lib/jquery1.4.4/jquery.min.js"></script>
    <script src="../../lib/jquery1.4.4/jquery.mobile-1.4.4.min.js"></script>
    -->

    <script src="../../commons/jquery.mobile/jquery.mobile-1.3.2.min.js"></script>
    <!--mobiscroll doc : http://docs.mobiscroll.com/2-11-1/mobiscroll-core-->
    <script src="../../lib/mobiscroll-2.6.2/js/mobiscroll.custom-2.6.2.min.js"
            type="text/javascript"></script>
    <script src="../../lib/mobiscroll-2.6.2/js/mobiscroll.android-ics-2.6.2.js"
            type="text/javascript"></script>
    <!--
        <script>

        HostApp = {
            getCurUser : function() {},
            toast : function(msg) {alert(msg);}
        };
        </script>-->

    <script src="../../commons/DataHelper.js"></script>
    <script src="../../commons/common.js"></script>
    <script src="js/process.js"></script>
    <style>
        ul.homeul {margin-top:15px; border-top: 1px solid #c8c8c8;
        border-bottom: #c8c8c8 1px solid;}
        table.layout {width:100%; height:45px; margin:0; background-color:
        transparent;border-collapse: collapse; }
        table.notlast {border-bottom: #c8c8c8 1px solid;}
        table.layoutwithmargintop {margin-top: 2em;}

        td.label {width: 6em; text-align: left; background-color:transparent;white-space: nowrap;
        font-size: 15px; color:#999999;font-weight: normal;}
        td.textvalue {width: auto; text-align:right; font-weight: normal;
        background-color:transparent;font-size: 15px; color:#333333;}
        td.icon {width: 20px; background-size:20px 20px;}
        td.space {width: 10px; }
        td.icon-input {
        background: transparent url("../../commons/images/custom/newflow-select.png") no-repeat
        right center;
        background-size:20px 20px;
        }
        td.icon-select {
        background: transparent url("../../commons/images/custom/newflow-select.png") no-repeat
        center;
        background-size:20px 20px;
        }
        td.icon-calendar {
        background: transparent url("../../commons/images/custom/newflow-calendar.png") no-repeat
        center;
        background-size:20px 20px;
        }
        td.icon-contact {
        background: transparent url("../../commons/images/custom/newflow-contact.png") no-repeat
        center;
        background-size:20px 20px;
        }
        r
        #textInput {background: #fff;}
        #textAreaInput {background: #fff; width: 100%;}
        #textInputCharCount {background-color: white;
        position: absolute;
        right: 10px;
        top: 17px;
        color: #999999;}
        #textAreaInputCharCount {
        background-color: white;
        position: absolute;
        right: 10px;
        bottom: 15px;
        color: #999999;
        }

        .ui-btn-up-e { text-align: center; color: #ed8223; text-shadow: 0 0 0 #fff;
        border-color:#f5f5f5; border-bottom: 2px solid #ed8223; border-left-width:0px;
        border-right-width: 0px;}

        .ui-shadow {box-shadow: 0 0px 0px rgba(0,0,0,.2);}
        .ui-overlay-shadow {box-shadow: 0 0 0px rgba(0,0,0,.6);}
        .ui-corner-all {border-radius: 0;}
        .ui-page{background: #f5f5f5;}
        .ui-body-d, .ui-overlay-d {border: 0px}
        .ui-li-static {background-color: #fff;}
        .ui-btn-up-d {background-image:none; }
        .ui-input-text.ui-focus {box-shadow: 0 0 0 transparent;}
        .ui-shadow-inset {box-shadow: 0 0px 0px transparent;}
        .ui-li:active {background-color: #c8c8c8; /* #686868;*/ text-shadow: 0 0px 0 #fff;}
        .ui-li:active td{/* color: white;*/}

        ul.homeul .ui-li {border: 0px }
        ul.homeul {}

        li.homeul {padding: 0em 15px;}
        ul.homeul .ui-li-static.ui-li {padding: 0 0 0 15px;}


        /*日历弹窗背景*/
        .dwo {opacity: .6;}

        /*弹窗Mask*/
        .ui-popup-screen {background: #000;}
        .ui-popup-screen.in {
        opacity: .6;
        }

        /*弹出菜单样式*/
        .ui-listview-inset .ui-li {
        border-right-width: 0px;
        border-left-width: 0px;
        }

        .ui-li, .ui-li.ui-field-contain {
        /*
        display: block;
        margin: 0;
        position: relative;
        overflow: visible;
        text-align: left;*/
        border-width: 0;

        border-bottom-width: 1px;
        }

        .ui-btn-up-e {
        text-align: center;
        color: #ed8223;
        text-shadow: 0 0 0 #fff;
        /*
        border-color: #f5f5f5;
        border-left-width: 0px;
        border-right-width: 0px;
        */
        border-bottom: 1px solid #ed8223;
        }
    </style>
</head>
<body>

<div data-role="page" id="home">
    <div id="ulContainer">
        <ul id="group1" class="homeul" data-role="listview" data-inset="true" data-theme="d">
        </ul>
        <ul id="group2" class="homeul" data-role="listview" data-inset="true" data-theme="d">
        </ul>
        <ul id="group3" class="homeul" data-role="listview" data-inset="true" data-theme="d">
        </ul>
    </div>
</div>

<div data-role="page" id="textInputPage" data-add-back-btn="true">


    <input type="text" id="textInput" value="">

    <div id="textInputCharCount">50</div>
    <!--
    <button id="textInputSubmit">提交</button>
    <button id="textInputCancel">返回</button> -->

</div>

<div data-role="page" id="textAreaInputPage" data-add-back-btn="true">


    <div data-role="fieldcontain">
        <textarea name="note" id="textAreaInput" style="height: 15em;"></textarea>

        <div id="textAreaInputCharCount">50</div>
    </div>

    <!--
    <button id="textAreaInputSubmit">提交</button>
    <button id="textAreaInputCancel">返回</button>-->

</div>


<script>
	var dynApp = {};
	dynApp.config = {
		groups: [
			{
					id: 'group1',
					items: [{
						name: 'address',
						title: '外出地点',
						dataType: 'string', //string, int, number, date, time, datetime, 
						value: '',
						displayValue: '',
						required: true,
						input: 'text', //text, textarea, select, date, time, datetime, number
						icon: '',
						maxLength: 30
					}]
			},
			{
				id: 'group2',
				items: [{
						name: 'startFullTime',
						title: '外出起始时间',
						dataType: 'datetime', //string, int, number, date, time, datetime, 
						value: '',
						displayValue: '',
						required: true,
						input: 'datetime', //text, textarea, select, date, time, datetime, number
						icon: '',
						defaultValueFun : function() {
							var now = new Date();
							var day = ("0" + now.getDate()).slice(-2);
							var month = ("0" + (now.getMonth() + 1)).slice(-2);
							var today = now.getFullYear()+"-"+(month)+"-"+(day) ;
							return today + ' 09:00';
						}
					},{
						name: 'endFullTime',
						title: '外出结束时间',
						dataType: 'datetime', //string, int, number, date, time, datetime, 
						value: '',
						displayValue: '',
						required: true,
						input: 'datetime', //text, textarea, select, date, time, datetime, number
						icon: '',
						defaultValueFun : function() {
							var now = new Date();
							var day = ("0" + now.getDate()).slice(-2);
							var month = ("0" + (now.getMonth() + 1)).slice(-2);
							var today = now.getFullYear()+"-"+(month)+"-"+(day) ;
							return today + ' 18:00';
						}
					}]
			},
			{
				id: 'group3',
				items: [{
						name: 'reason',
						title: '外出原因',
						dataType: 'string', //string, int, number, date, time, datetime, 
						value: '',
						displayValue: '',
						required: true,
						input: 'select', //text, textarea, select, date, time, datetime, number
						icon: '', //
						selectOptions : [{value:'visit', text:'拜访客户'}, 
							{value:'metting', text:'外出会议'}, 
							{value:'train', text:'外出培训'}, 
							{value:'other', text:'其他'}]
					},{
						name: 'note',
						title: '外出事由',
						dataType: 'string', //string, int, number, date, time, datetime, 
						value: '', //text, textarea, select, date, time, datetime, number
						displayValue: '',
						required: true,
						input: 'textarea',
						icon: '',
						maxLength: 200
					}]
			}
		],
		

	};
	dynApp.result = {};
	dynApp.currentPage = "home"; //当前页
	dynApp.dataModified = false;
	dynApp.maxInputLength = 0;  //当前输入最大允许长度

	initItemsDefaultValue();

	function initListView() {
		var groups = dynApp.config.groups;
		for(var j = 0; j < groups.length; j++) {
			var ulContent = '';
			
			var items = groups[j].items;
			for (var i = 0; i < items.length; i++)
			{
				ulContent = ulContent + getListViewItem(items[i]) + "\n";
			}
			
			$("#" + groups[j].id).append(ulContent);
		}

	}

	function getListViewItem(itemConfig) {
		if (itemConfig.input === 'text')
		{
			return getListViewTextItem(itemConfig);
		} else if (itemConfig.input === 'textarea')
		{
			return getListViewTextAreaItem(itemConfig);
		} else if (itemConfig.input === 'select')
		{
			return getListViewSelectItem(itemConfig);
		} else if ($.inArray(itemConfig.input, ['date', 'time', 'datetime']) >= 0)
		{
			return getListViewDateItem(itemConfig);
		}
	}

	function getListViewTextItem(itemConfig) {
		var result = '<li class="homeul" id="' + getListViewItemId(itemConfig) + '">' +
				'<table class="layout ' + getNotLastItemClass(itemConfig) + '"><tr>' + 
					'<td class="label">' + itemConfig.title + '</td>' + 
					'<td class="textvalue"><span id="' + getListViewItemValueId(itemConfig) + '">' + itemConfig.displayValue + '</span></td>' + 
					'<td class="icon icon-input"></td>' + 
					'<td class="space"></td>' +
				'</tr></table>' +
			'</li>';
		return result;
	}

	function getListViewTextAreaItem(itemConfig) {
		var result = '<li id="' + getListViewItemId(itemConfig) + '">' +
				'<table class="layout ' + getNotLastItemClass(itemConfig) + '"><tr>' + 
					'<td class="label">' + itemConfig.title + '</td>' + 
					'<td class="textvalue"><span id="' + getListViewItemValueId(itemConfig) + '">' + itemConfig.displayValue + '</span></td>' + 
					'<td class="icon icon-input"></td>' + 
					'<td class="space"></td>' +
				'</tr></table>' +
			'</li>';
		return result;
	}

	function getListViewSelectItem(itemConfig) {
		var result = '<li id="' + getListViewItemId(itemConfig) + '">' + 
				'<table class="layout ' + getNotLastItemClass(itemConfig) + '"><tr>' + 
					'<td class="label">' + itemConfig.title + '</td>' + 
					'<td class="textvalue"><span id="' + getListViewItemValueId(itemConfig) + '">' + itemConfig.displayValue + '</span></td>' + 
					'<td class="icon icon-select"></td>' + 
					'<td class="space"></td>' +
				'</tr></table>' +
				'	<div data-role="popup" id="' + getPopupMenuId(itemConfig) + '" data-theme="d" data-overlay-theme="a">' +
				'		<ul id="'+ getPopupMenuULId(itemConfig) + '" data-role="listview" data-inset="true" style="min-width:210px;" data-theme="d">' +
				'		</ul>' +
				'	</div>' + 
			'</li>';
		return result;
	}

	function getListViewDateItem(itemConfig) {
		var result = '<li id="' + getListViewItemId(itemConfig) + '">' +
				'<table class="layout ' + getNotLastItemClass(itemConfig) + '"><tr>' + 
					'<td class="label">' + itemConfig.title + '</td>' + 
					'<td class="textvalue"><span id="' + getListViewItemValueId(itemConfig) + '">' + itemConfig.displayValue + '</span></td>' + 
					'<td class="icon icon-calendar"></td>' + 
					'<td class="space"></td>' +
				'</tr></table>' +
			'</li>';
		return result;
	}

	function initItemsDefaultValue() {
		var groups = dynApp.config.groups;
		for(var j = 0; j < groups.length; j++) {
			var items = groups[j].items;
			for (var i = 0; i < items.length; i++)
			{
				if (items[i].defaultValueFun)
				{
					items[i].value = items[i].defaultValueFun();
					items[i].displayValue = items[i].value;
				} 

				items[i].isLastItem = i === (items.length - 1);
			}
		}
	}

	function getNotLastItemClass(itemConfig) {
		if (! itemConfig.isLastItem)
		{
			return "notlast";
		} 
		
		return "";
	}

	/*******************************************************************
	* 初始化弹出菜单
	*******************************************************************/
	function initPopupMenus() {
		var groups = dynApp.config.groups;
		for(var j = 0; j < groups.length; j++) {
			var items = groups[j].items;
			for (var i = 0; i < items.length; i++)
			{
				if (items[i].selectOptions && items[i].selectOptions.length > 0)
				{
					initPopupMenu(items[i]);
				}
			}
		}
	}

	function initPopupMenu(itemConfig) {
		var li = '<li data-role="divider" data-theme="e">' + itemConfig.title + '</li>';
		var entries = itemConfig.selectOptions;
		for (i = 0; i < entries.length; i++) {
			li += '<li data-icon="false">' + entries[i].text + "</li>";
		}
		var id = getPopupMenuULId(itemConfig)
		$("#" + id).append(li).promise().done(function () {
			//refresh list here 
			//$(this).listview("refresh");
			//then add click event using delegation
			$(this).on("click", "li", function () {
				var text = $(this).text();
				if (itemConfig.title === text)
				{
					//选择的是标题，返回。
					return;
				}
				var value = getSelectOptionValue(itemConfig, text);
				$("#" + getPopupMenuId(itemConfig)).popup( "close" );
				setItemValue(itemConfig, value, text);
			});
		});

		$("#" + getListViewItemId(itemConfig)).on("click", function(e){
		        dynApp.currentPage = "popupMenu";
			    dynApp.currentPopupWindowId = "#" + getPopupMenuId(itemConfig);
				$("#" + getPopupMenuId(itemConfig)).popup("open");
			}
		);
	}

	function getSelectOptionValue(itemConfig, text) {
		if (itemConfig.selectOptions && itemConfig.selectOptions.length > 0)
		{
			var entries = itemConfig.selectOptions;
			for(var i = 0; i < entries.length; i++) {
				if (entries[i].text === text)
				{
					return entries[i].value;
				}
			}
		}

		return undefined;
	}


	/*******************************************************************
	* 初始化日期控件
	*******************************************************************/
	function initDateControls() {
		var groups = dynApp.config.groups;
		for(var j = 0; j < groups.length; j++) {
			var items = groups[j].items;

			for (var i = 0; i < items.length; i++)
			{
				if ($.inArray(items[i].input, ['date', 'time', 'datetime']) >= 0)
				{
					setDateControl(items[i]);
				}
			}
		}
	}

	function setDateControl(itemConfig) {
		var opt = {
			preset: 'datetime', //日期
			theme: 'android-ics light', //皮肤样式
			display: 'modal', //显示方式 
			mode: 'scroller', //日期选择模式
			lang: 'zh',
			dateFormat: 'yy-mm-dd', // 日期格式
			setText: '确定', //确认按钮名称
			cancelText: '取消',//取消按钮名籍我
			dateOrder: 'yymmdd', //面板中日期排列格式
			dayText: '日', monthText: '月', yearText: '年', //面板中年月日文字
			endYear:2030, //结束年份,

			onShow : function(html, valueText, inst) {
			    dynApp.currentPage = "mobiScroll";
			    dynApp.currentPopupWindowId = "#" + getListViewItemId(itemConfig);
			},

			onClose : function(valueText, btn, inst) {
				if (btn === 'set')
				{
					setItemValue(itemConfig, valueText, valueText);
				}
			}
		};
		opt.preset = itemConfig.input;

		$("#" + getListViewItemId(itemConfig)).mobiscroll(opt);
		$("#" + getListViewItemId(itemConfig)).mobiscroll('setValue', itemConfig.value, true);
	}

	/*******************************************************************
	* 初始化MobiScroll选择控件
	******************************************************************
	function initMobiScrollSelectControls() {
		var groups = dynApp.config.groups;
		for(var j = 0; j < groups.length; j++) {
			var items = groups[j].items;

			for (var i = 0; i < items.length; i++)
			{
				if (items[i].input === 'select2')
				{
					setMobiScrollSelectControl(items[i]);
				}
			}
		}
	}

	function setMobiScrollSelectControl(itemConfig) {
		var opt = {
			preset: 'select', //日期
			theme: 'android-ics light', //皮肤样式
			display: 'modal', //显示方式
			mode: 'scroller', //日期选择模式
			lang: 'zh',
			dateFormat: 'yy-mm-dd', // 日期格式
			setText: '确定', //确认按钮名称
			cancelText: '取消',//取消按钮名籍我
			dateOrder: 'yymmdd', //面板中日期排列格式
			dayText: '日', monthText: '月', yearText: '年', //面板中年月日文字
			endYear:2030, //结束年份,
			showInput: false,

			onClose : function(valueText, btn, inst) {
				if (btn === 'set')
				{
					setItemValue(itemConfig, valueText, valueText);
					dynApp.dataModified = true;
				}
			}
		};
		//opt.preset = itemConfig.input;

		$("#" + getListViewItemId(itemConfig)).mobiscroll(opt);
		$("#" + getListViewItemId(itemConfig)).mobiscroll('setValue', itemConfig.value, true);
	}
*/
	
	/*******************************************************************
	* 初始化input, textarea跳转
	*******************************************************************/
	function initInputControlls() {
		var groups = dynApp.config.groups;
		for(var j = 0; j < groups.length; j++) {
			var items = groups[j].items;
			for (var i = 0; i < items.length; i++)
			{
				if (items[i].input === 'text')
				{
					initTextInputControl(items[i]);
				} else if (items[i].input === 'textarea')
				{
					initTextAreaControl(items[i]);
				}
			}
		}
	}

	function initTextInputControl(itemConfig) {
		$("#" + getListViewItemId(itemConfig)).on('click', function(e) {
			//$.mobile.pageContainer.pagecontainer("change", "#textInputPage");
			//$("body").pagecontainer("change", "#textInputPage");
			$("#textInput").val(itemConfig.value);
			$("#textInput").attr("placeholder", "请输入" + itemConfig.title);
			$.mobile.changePage('#textInputPage',{
				  transition: "slide",
				  reverse: false,
				  changeHash: true
				});
			dynApp.currentPage = "textInputPage";
			dynApp.currentItem = itemConfig;

			setInputControlMaxLength("#textInput", itemConfig.maxLength);
			initCharCount("#textInputCharCount", itemConfig.maxLength);
			$('#textInput').trigger('input');

			setTimeout(function(){
				document.getElementById("textInput").focus();
			}, 300);

			changeTitle(itemConfig.title);
		});
	}

	function initTextAreaControl(itemConfig) {
		$("#" + getListViewItemId(itemConfig)).on('click', function(e) {
			$("#textAreaInput").val(itemConfig.value);
			$("#textAreaInput").attr("placeholder", "请输入" + itemConfig.title);
			$.mobile.changePage('#textAreaInputPage',{
				  transition: "slide",
				  reverse: false,
				  changeHash: true
				});
			dynApp.currentPage = "textAreaInputPage";
			dynApp.currentItem = itemConfig;

			setInputControlMaxLength("#textAreaInput", itemConfig.maxLength);
			initCharCount("#textAreaInputCharCount", itemConfig.maxLength);
			$('#textAreaInput').trigger('input');

			setTimeout(function(){
				document.getElementById("textAreaInput").focus();
			}, 300);

			changeTitle(itemConfig.title);
		});
	}

	function setInputControlMaxLength(controlId, maxlength) {
		if (maxlength)
		{
			dynApp.maxInputLength = maxlength;
			$(controlId).attr("maxlength", maxlength);
		} else {
			dynApp.maxInputLength = 0;
			$(controlId).removeAttr("maxlength");
		}
	}

	function initCharCount(countId, maxlength) {
		if (maxlength)
		{
			$(countId).text("" + maxlength);
		} else {
			$(countId).text("");
		}
	}

	/**字数统计
	*/
	$(document).on('input','#textAreaInput',function(e){ 
		var limit = parseInt($(this).attr('maxlength'));
		if (limit)
		{
			var text = $(this).val();
			var chars = text.length;
			$("#textAreaInputCharCount").text("" + (limit - chars));
		}
	});

	$(document).on('input','#textInput',function(e){ 
		var limit = parseInt($(this).attr('maxlength'));
		if (limit)
		{
			var text = $(this).val();
			var chars = text.length;
			$("#textInputCharCount").text("" + (limit - chars));
		}
	});

	/*******************************************************************
	* 获取相关的DOM ID
	*******************************************************************/

	/**
	* 获取主列表，每个li的ID
	*/
	function getListViewItemId(itemConfig) {
		return 'mainlvli-' + itemConfig.name;
	}

	/**
	* 获取主列表，每个li的值对应的ID
	*/
	function getListViewItemValueId(itemConfig) {
		return 'mainlvli-value-' + itemConfig.name;
	}

	/**
	* 获取弹出菜单的ID
	*/
	function getPopupMenuId(itemConfig) {
		return 'popupmenu-' + itemConfig.name;
	}

	/**
	* 获取弹出菜单UL的ID
	*/
	function getPopupMenuULId(itemConfig) {
		return 'popupmenu-ul-' + itemConfig.name;
	}

	/*******************************************************************
	* 提交相关处理
	*******************************************************************/
	/**
	* 提交前的自定义校验。
	* 返回：false: 失败，true: 成功
	*/
	function customValid() {
		
	}

	function changeTitle(title) {
	    HostApp.notifyActivityEvent("createProcess", "changeTitle", title);
	}

	/*******************************************************************
	* 按钮事件处理
	*******************************************************************/
	function okBtnClick() {
		if (dynApp.currentPage === "home") 
		{
			//校验并提交

			//校验
			var groups = dynApp.config.groups;
			for(var j = 0; j < groups.length; j++) {
				var items = groups[j].items;
				for (var i = 0; i < items.length; i++)
				{
					if (! isValid(items[i], items[i].value))
					{
						myalert(items[i].title + "不能为空。");
						return;
					}

					dynApp.result[items[i].name] = items[i].value;
				}
			}

			//提交
			var loginUser = DataHelper.getCurUser();
			var submitJson = {appId:"3",loginName:loginUser.loginName}//外出申请的APPid为3
			var startArray = dynApp.result.startFullTime.split(" ");
			var endArray = dynApp.result.endFullTime.split(" ");
			if (startArray[0] === endArray[0])
			{
				dynApp.result.title=loginUser.nickName+"【"+startArray[0]+"】的外出申请";
			} else {
				dynApp.result.title=loginUser.nickName+"【"+startArray[0]+"~"+ endArray[0]+"】的外出申请";
			}

			submitJson['submitData']=dynApp.result;//是定提交的表单数据
			$("body").mask("");
			$.mobile.loading('show');

			DataHelper.proxyReq(DataHelper.createProcessUrl, JSON.stringify(submitJson),function(msgObj){
				var rstCode = msgObj.result;
				if(rstCode!='0'){//代理访问失败
					$("body").unmask();
					$.mobile.loading('hide');
					HostApp.toast(msgObj.message||"外出申请提交失败！");
				}else{//代理访问成功
					var rst = JSON.parse(msgObj.content);
					$("body").unmask();
					$.mobile.loading('hide');
					if (!rst||typeof(rst.result)=='undefined'||rst.result==null||rst.result != '0') {
						myalert("外出申请提交失败！");
					} else {
						//$("#submit").button('disable'); 
						myalert('新建外出申请成功！');
						HostApp.goBack();
					}
				}
			});
		} else if (dynApp.currentPage === "textInputPage")
		{
			//文本输入
			var value = $("#textInput").val();
			if (! isValid(dynApp.currentItem, value))
			{
				myalert(dynApp.currentItem.title + " 不允许为空。");
				return;
			}
			setItemValue(dynApp.currentItem, value, value);
			gotoHome();
		} else if (dynApp.currentPage === "textAreaInputPage") {
			//多文本输入
			var value = $("#textAreaInput").val();
			if (! isValid(dynApp.currentItem, value))
			{
				myalert(dynApp.currentItem.title + " 不允许为空。");
				return;
			}
			setItemValue(dynApp.currentItem, value, value);
			gotoHome();
		}
	}

	function gotoHome() {
		$.mobile.changePage('#home',{
			  transition: "slide",
			  reverse: true,
			  changeHash: false
			});
		dynApp.currentPage = "home";
		changeTitle("创建电子流");
	}

	function backBtnClick() {
	    if (dynApp.currentPage === "mobiScroll") {
            //关闭日历弹窗
            $(dynApp.currentPopupWindowId).mobiscroll('hide');
	    } else if (dynApp.currentPage === "popupMenu") {
            //关闭选择弹窗
            $(dynApp.currentPopupWindowId).popup("close");
	    } else if (dynApp.currentPage === "textInputPage" ||
	                dynApp.currentPage === "textAreaInputPage")
		{
			gotoHome();
		} else {
			HostApp.goBack();
			/*
			if (dynApp.dataModified)
			{
				myalert("有数据修改");
			} else {
				myalert("有数据修改2");
				HostApp.goBack();
			}
			*/
		}
	}


    function isValid(itemConfig, value) {
		if (itemConfig.required)
		{
			if (value == undefined || value == null || value.length == 0)
			{
				return false;
			}
		}

		return true;
	}

	function myalert(msg) {
		//alert(msg);
		HostApp.toast(msg);
	}

	function isOKBtnVisible() {
		myalert("设置可视");
		HostApp.setResultValue("true");
	}

	function setItemValue(itemConfig, value, text) {
		itemConfig.value = value;
		itemConfig.displayValue = text;
		dynApp.dataModified = true;
		$("#" + getListViewItemValueId(itemConfig)).text(text);
	}

	initListView();
	initPopupMenus();

	$(document).on("pageinit", "#home", function () {
		initDateControls();
		initInputControlls();


		


		//initMobiScrollSelectControls();
		/*
		var opt = {
			preset: 'select', //日期
			theme: 'android-ics light', //皮肤样式
			display: 'modal', //显示方式 
			mode: 'scroller', //日期选择模式
			lang: 'zh',
			dateFormat: 'yy-mm-dd', // 日期格式
			setText: '确定', //确认按钮名称
			cancelText: '取消',//取消按钮名籍我
			dateOrder: 'yymmdd', //面板中日期排列格式
			dayText: '日', monthText: '月', yearText: '年', //面板中年月日文字
			endYear:2030, //结束年份,

			onClose : function(valueText, btn, inst) {
				if (btn === 'set')
				{
					//setItemValue(itemConfig, valueText, valueText);
				}
			}
		};
		

		$("#aaa").mobiscroll(opt);
		*/

/*
		$("#textInputSubmit").on("click", function(e) {
			//document.getElementById("textInput").focus();  
			backBtnClick();
			});
		$("#textAreaInputSubmit").on("click", function(e) {okBtnClick();});

		$("#textInputCancel").on("click", function(e) {backBtnClick();});
		$("#textAreaInputCancel").on("click", function(e) {backBtnClick();});
		*/

		//$("#aaa").mobiscroll().select({ theme: 'ios', display: 'bottom'});
	});

	




</script>


</body>
</html>